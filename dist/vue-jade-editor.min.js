/**
 * vue-jade-editor
 * @version v0.1.0 - 2016-04-22
 * @link http://html5beta.com/apps/vue-jade-editor.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){var s={"default":{indent:"    ",template:'<div class="jade-editor"><textarea rows="{{rows}}" class="{{cls}}" @keyup="keyup($event)" @keydown="keydown($event)" @click="syncSelection()" @change="syncSelection()">{{content}}</textarea></div>',data:function(){return{_textarea:!1,nSelStart:0,nSelEnd:0,cls:"form-control"}}},keycodes:{keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}}};s.install=function(t){t.component("jadeeditor",{template:s["default"].template,props:{content:String,rows:Number,id:String},data:s["default"].data,events:{"je-insert-content":function(t,e,n){if(e===this.id){var s=this.getTextArea(),i=this.nSelStart,l=this.nSelEnd,a=s.value;s.value=a.substring(0,i)+t+a.substring(l),s.selectionStart=n?i:l+t.length,s.selectionEnd=l+t.length,this.updateSyntax()}}},methods:{keyup:function(t){var e=t.keyCode,n=s.keycodes.keyup[e];return n?void this["handleKeyEvt_"+n](t,this.updateSyntax):this.updateSyntax()},keydown:function(t){var e=t.keyCode,n=s.keycodes.keydown[e];n&&this["handleKeyEvt_"+n](t,this.updateSyntax)},getTextArea:function(){return this._textarea?this._textarea:(this._textarea=this.$el.children[0],this._textarea)},syncSelection:function(){var t=this.getTextArea();t.selectionStart;this.nSelStart=t.selectionStart,this.nSelEnd=t.selectionEnd},updateSyntax:function(){var t=this.getTextArea();this.content=t.value,this.syncSelection(),this.autoGrow()},autoGrow:function(){var t=this.getTextArea();t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+10+"px")},handleKeyEvt_tab:function(t,e){t.preventDefault();var n=this,i=this.getTextArea(),l=s["default"].indent,a=i.selectionStart,r=i.selectionEnd,c=i.value,u=c.substring(a,r),o=c.substring(a-1,a);"\n"!==o&&""!==o?i.value=c.substring(0,a)+l+c.substring(r):(u=l+u.replace(/\n/g,"\n"+l),i.value=c.substring(0,a)+u+c.substring(r),i.selectionStart=a===r?a+l.length:a,i.selectionEnd=a===r?a+l.length:a+u.length),e.call(n)},handleKeyEvt_enter:function(t,e){var n=this,i=s["default"].indent,l=this.getTextArea(),a=l.selectionStart,r=l.selectionEnd,c=l.value,u=c.substring(0,a).split("\n"),o=u.length,d=u[o-2],h=/^( *)/,g=d.match(h),v=g[1];l.value=c.substring(0,a)+v+i+c.substring(r),l.selectionStart=a+v.length+i.length,l.selectionEnd=l.selectionStart,e.call(n)},handleKeyEvt_backspace:function(t,e){var n=this,i=s["default"].indent,l=i.length,a=this.getTextArea(),r=a.selectionStart,c=a.selectionEnd,u=a.value,o=u.substring(0,r),d=o.split("\n"),h=d.length,g=d[h-1],v=/^ *$/.test(g),b=r-g.length,f=u.substring(b,r),y=f.length;!v||l>y||(t.preventDefault(),a.value=u.substring(0,b)+f.replace(i,"")+u.substring(c),e.call(n))},handleKeyEvt_open_bracket:function(t,e){var n=this,i=s["default"].indent,l=this.getTextArea(),a=l.selectionStart,r=l.selectionEnd,c=l.value,u=c.substring(a,r),o=t.shiftKey?"{":"[",d=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return l.value=c.substring(0,a)+o+u+d+c.substring(r),l.selectionStart=a===r?a+1:a,l.selectionEnd=r+(a===r?1:2),e.call(n);var h=!u.length;if(h){var g=c.substring(0,a).split("\n"),v=g.length;u=g[v-1];var b=a-u.length,f=c.substring(0,b)}for(var y=u.split("\n"),p=y.length,S=[],E=new RegExp("^"+i),x=0;p>x;x++)S.push(y[x].replace(E,""));u=S.join("\n"),h?(l.value=f+u+c.substring(r),l.selectionStart=f.length,l.selectionEnd=f.length):(l.value=c.substring(0,a)+u+c.substring(r),l.selectionStart=a,l.selectionEnd=a+(a===r?0:u.length+1)),e.call(n)},handleKeyEvt_close_bracket:function(t,e){return t.ctrlKey?this.handleKeyEvt_tab(t,e):void 0},handleKeyEvt_single_quote:function(t,e){var n=this,s=this.getTextArea(),i=s.selectionStart,l=s.selectionEnd,a=s.value,r=t.shiftKey?'"':"'";t.preventDefault(),s.value=a.substring(0,i)+r+a.substring(i,l)+r+a.substring(l),s.selectionStart=i===l?i+1:i,s.selectionEnd=l+(i===l?1:2),e.call(n)},handleKeyEvt_left_bracket:function(t,e){var n=this,s=this.getTextArea(),i=s.selectionStart,l=s.selectionEnd,a=s.value;t.shiftKey?'"':"'";return t.shiftKey?(t.preventDefault(),s.value=a.substring(0,i)+"("+a.substring(i,l)+")"+a.substring(l),s.selectionStart=i===l?i+1:i,s.selectionEnd=l+(i===l?1:2),void e.call(n)):e.call(n)},handleKeyEvt_i:function(t,e){var n=this,s=this.getTextArea(),i=s.selectionStart,l=s.selectionEnd,a=s.value;return t.ctrlKey?(t.preventDefault(),s.value=a.substring(0,i)+"<i>"+a.substring(i,l)+"</i>"+a.substring(l),s.selectionStart=i===l?i+3:i,s.selectionEnd=l+(i===l?3:7),void e.call(n)):e.call(n)},handleKeyEvt_b:function(t,e){var n=this,s=this.getTextArea(),i=s.selectionStart,l=s.selectionEnd,a=s.value;return t.ctrlKey?(t.preventDefault(),s.value=a.substring(0,i)+"<b>"+a.substring(i,l)+"</b>"+a.substring(l),s.selectionStart=i===l?i+3:i,s.selectionEnd=l+(i===l?3:7),void e.call(n)):e.call(n)}}})},"object"==typeof exports?module.exports=s:"function"==typeof define&&define.amd?define([],function(){return s}):t.Vue&&(t.jadeEditor=s)}(window,document);