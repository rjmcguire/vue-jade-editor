/**
 * vue-jade-editor
 * @version v0.0.1 - 2016-04-13
 * @link http://html5beta.com/apps/vue-jade-editor.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){var i={"default":{indent:"    ",template:'<div class="jade-editor-box"><div class="jade-editor"><textarea @keyup="keyup($event)" @keydown="keydown($event)">{{content}}</textarea><pre class="jade-editor-syntax prettyprint" lang="{{lang}}"></pre></div></div>',data:function(){return{_textarea:!1,_pre:!1,nSelStart:0,nSelEnd:0}}},keycodes:{keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}}};i.install=function(t){t.component("jadeeditor",{template:i["default"].template,props:{content:String,lang:String},data:i["default"].data,events:{"je-insert-content":function(t,e){var n=this.getTextArea(),i=this.nSelStart,s=this.nSelEnd,l=n.value;n.value=l.substring(0,i)+t+l.substring(s),n.selectionStart=e?i:s+t.length,n.selectionEnd=s+t.length,this.updateSyntax()}},methods:{keyup:function(t){var e=t.keyCode,n=i.keycodes.keyup[e];return n?void this["handleKeyEvt_"+n](t,this.updateSyntax):this.updateSyntax()},keydown:function(t){var e=t.keyCode,n=i.keycodes.keydown[e];n&&this["handleKeyEvt_"+n](t,this.updateSyntax)},getTextArea:function(){return this._textarea?this._textarea:(this._textarea=this.$el.children[0].children[0],this._textarea)},getPre:function(){return this._pre?this._pre:(this._pre=this.$el.children[0].children[1],this._pre)},syncSelection:function(){var t=this.getTextArea();t.selectionStart;this.nSelStart=t.selectionStart,this.nSelEnd=t.selectionEnd},updateSyntax:function(){var t=this.getTextArea(),e=this.getPre();e&&(e.innerHTML=t.value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.classList.remove("prettyprinted"),this.syncSelection(),prettyPrint(null,this.$el),this.autoGrow())},autoGrow:function(){var t=this.getTextArea();t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+10+"px")},handleKeyEvt_tab:function(t,e){t.preventDefault();var n=this,s=this.getTextArea(),l=i["default"].indent,a=s.selectionStart,r=s.selectionEnd,u=s.value,c=u.substring(a,r),o=u.substring(a-1,a);"\n"!==o&&""!==o?s.value=u.substring(0,a)+l+u.substring(r):(c=l+c.replace(/\n/g,"\n"+l),s.value=u.substring(0,a)+c+u.substring(r),s.selectionStart=a===r?a+l.length:a,s.selectionEnd=a===r?a+l.length:a+c.length),e.call(n)},handleKeyEvt_enter:function(t,e){var n=this,s=i["default"].indent,l=this.getTextArea(),a=l.selectionStart,r=l.selectionEnd,u=l.value,c=u.substring(0,a).split("\n"),o=c.length,d=c[o-2],h=/^( *)/,g=d.match(h),v=g[1];l.value=u.substring(0,a)+v+s+u.substring(r),l.selectionStart=a+v.length+s.length,l.selectionEnd=l.selectionStart,e.call(n)},handleKeyEvt_backspace:function(t,e){var n=this,s=i["default"].indent,l=s.length,a=this.getTextArea(),r=a.selectionStart,u=a.selectionEnd,c=a.value,o=c.substring(0,r),d=o.split("\n"),h=d.length,g=d[h-1],v=/^ *$/.test(g),p=r-g.length,b=c.substring(p,r),f=b.length;!v||l>f||(t.preventDefault(),a.value=c.substring(0,p)+b.replace(s,"")+c.substring(u),e.call(n))},handleKeyEvt_open_bracket:function(t,e){var n=this,s=i["default"].indent,l=this.getTextArea(),a=l.selectionStart,r=l.selectionEnd,u=l.value,c=u.substring(a,r),o=t.shiftKey?"{":"[",d=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return l.value=u.substring(0,a)+o+c+d+u.substring(r),l.selectionStart=a===r?a+1:a,l.selectionEnd=r+(a===r?1:2),e.call(n);var h=!c.length;if(h){var g=u.substring(0,a).split("\n"),v=g.length;c=g[v-1];var p=a-c.length,b=u.substring(0,p)}for(var f=c.split("\n"),y=f.length,S=[],E=new RegExp("^"+s),x=0;y>x;x++)S.push(f[x].replace(E,""));c=S.join("\n"),h?(l.value=b+c+u.substring(r),l.selectionStart=b.length,l.selectionEnd=b.length):(l.value=u.substring(0,a)+c+u.substring(r),l.selectionStart=a,l.selectionEnd=a+(a===r?0:c.length+1)),e.call(n)},handleKeyEvt_close_bracket:function(t,e){return t.ctrlKey?this.handleKeyEvt_tab(t,e):void 0},handleKeyEvt_single_quote:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,l=i.selectionEnd,a=i.value,r=t.shiftKey?'"':"'";t.preventDefault(),i.value=a.substring(0,s)+r+a.substring(s,l)+r+a.substring(l),i.selectionStart=s===l?s+1:s,i.selectionEnd=l+(s===l?1:2),e.call(n)},handleKeyEvt_left_bracket:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,l=i.selectionEnd,a=i.value;t.shiftKey?'"':"'";return t.shiftKey?(t.preventDefault(),i.value=a.substring(0,s)+"("+a.substring(s,l)+")"+a.substring(l),i.selectionStart=s===l?s+1:s,i.selectionEnd=l+(s===l?1:2),void e.call(n)):e.call(n)},handleKeyEvt_i:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,l=i.selectionEnd,a=i.value;return t.ctrlKey?(t.preventDefault(),i.value=a.substring(0,s)+"<i>"+a.substring(s,l)+"</i>"+a.substring(l),i.selectionStart=s===l?s+3:s,i.selectionEnd=l+(s===l?3:7),void e.call(n)):e.call(n)},handleKeyEvt_b:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,l=i.selectionEnd,a=i.value;return t.ctrlKey?(t.preventDefault(),i.value=a.substring(0,s)+"<b>"+a.substring(s,l)+"</b>"+a.substring(l),i.selectionStart=s===l?s+3:s,i.selectionEnd=l+(s===l?3:7),void e.call(n)):e.call(n)}}})},"object"==typeof exports?module.exports=i:"function"==typeof define&&define.amd?define([],function(){return i}):t.Vue&&Vue.use(i)}(window,document);