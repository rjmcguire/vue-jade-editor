/**
 * vue-jade-editor
 * @version v0.2.0 - 2016-05-21
 * @link http://html5beta.com/apps/vue-jade-editor.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){var i={"default":{indent:"    ",template:'<div class="jade-editor"><textarea rows="{{rows}}" class="{{cls}}" @keyup="keyup($event)" @keydown="keydown($event)" @click="syncSelection()" @change="syncSelection()">{{content}}</textarea></div>',data:function(){return{_textarea:!1,nSelStart:0,nSelEnd:0,cls:"form-control"}}},keycodes:{keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}}};i.install=function(t){t.component("jadeeditor",{template:i["default"].template,props:{content:String,rows:Number,id:String},data:i["default"].data,events:{"je-insert-content":function(t,e,n){if(e===this.id){var i=this.getTextArea(),s=this.nSelStart,a=this.nSelEnd,l=i.value;i.value=l.substring(0,s)+t+l.substring(a),i.selectionStart=n?s:a+t.length,i.selectionEnd=a+t.length,this.updateSyntax()}},"je-tab":function(t){t===this.id&&this.handleKeyEvt_tab({preventDefault:function(){}},this.updateSyntax)},"je-untab":function(t){t===this.id&&this.handleKeyEvt_open_bracket({preventDefault:function(){},ctrlKey:!0},this.updateSyntax)},"je-i":function(t){t===this.id&&this.handleKeyEvt_i({preventDefault:function(){},ctrlKey:!0},this.updateSyntax)},"je-b":function(t){t===this.id&&this.handleKeyEvt_b({preventDefault:function(){},ctrlKey:!0},this.updateSyntax)}},methods:{keyup:function(t){var e=t.keyCode,n=i.keycodes.keyup[e];return n?void this["handleKeyEvt_"+n](t,this.updateSyntax):this.updateSyntax()},keydown:function(t){var e=t.keyCode,n=i.keycodes.keydown[e];n&&this["handleKeyEvt_"+n](t,this.updateSyntax)},getTextArea:function(){return this._textarea?this._textarea:(this._textarea=this.$el.children[0],this._textarea)},syncSelection:function(){var t=this.getTextArea();t.selectionStart;this.nSelStart=t.selectionStart,this.nSelEnd=t.selectionEnd},updateSyntax:function(){var t=this.getTextArea();this.content=t.value,this.syncSelection(),this.autoGrow()},autoGrow:function(){var t=this.getTextArea();t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+10+"px")},handleKeyEvt_tab:function(t,e){t.preventDefault();var n=this,s=this.getTextArea(),a=i["default"].indent,l=s.selectionStart,r=s.selectionEnd,u=s.value,c=u.substring(l,r),o=u.substring(l-1,l);"\n"!==o&&""!==o?s.value=u.substring(0,l)+a+u.substring(r):(c=a+c.replace(/\n/g,"\n"+a),s.value=u.substring(0,l)+c+u.substring(r),s.selectionStart=l===r?l+a.length:l,s.selectionEnd=l===r?l+a.length:l+c.length),e.call(n)},handleKeyEvt_enter:function(t,e){var n=this,s=i["default"].indent,a=this.getTextArea(),l=a.selectionStart,r=a.selectionEnd,u=a.value,c=u.substring(0,l).split("\n"),o=c.length,h=c[o-2],d=/^( *)/,g=h.match(d),v=g[1];a.value=u.substring(0,l)+v+s+u.substring(r),a.selectionStart=l+v.length+s.length,a.selectionEnd=a.selectionStart,e.call(n)},handleKeyEvt_backspace:function(t,e){var n=this,s=i["default"].indent,a=s.length,l=this.getTextArea(),r=l.selectionStart,u=l.selectionEnd,c=l.value,o=c.substring(0,r),h=o.split("\n"),d=h.length,g=h[d-1],v=/^ *$/.test(g),f=r-g.length,y=c.substring(f,r),b=y.length;!v||a>b||(t.preventDefault(),l.value=c.substring(0,f)+y.replace(s,"")+c.substring(u),e.call(n))},handleKeyEvt_open_bracket:function(t,e){var n=this,s=i["default"].indent,a=this.getTextArea(),l=a.selectionStart,r=a.selectionEnd,u=a.value,c=u.substring(l,r),o=t.shiftKey?"{":"[",h=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return a.value=u.substring(0,l)+o+c+h+u.substring(r),a.selectionStart=l===r?l+1:l,a.selectionEnd=r+(l===r?1:2),e.call(n);var d=!c.length;if(d){var g=u.substring(0,l).split("\n"),v=g.length;c=g[v-1];var f=l-c.length,y=u.substring(0,f)}for(var b=c.split("\n"),p=b.length,S=[],E=new RegExp("^"+s),x=0;p>x;x++)S.push(b[x].replace(E,""));c=S.join("\n"),d?(a.value=y+c+u.substring(r),a.selectionStart=y.length,a.selectionEnd=y.length):(a.value=u.substring(0,l)+c+u.substring(r),a.selectionStart=l,a.selectionEnd=l+(l===r?0:c.length+1)),e.call(n)},handleKeyEvt_close_bracket:function(t,e){return t.ctrlKey?this.handleKeyEvt_tab(t,e):void 0},handleKeyEvt_single_quote:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,a=i.selectionEnd,l=i.value,r=t.shiftKey?'"':"'";t.preventDefault(),i.value=l.substring(0,s)+r+l.substring(s,a)+r+l.substring(a),i.selectionStart=s===a?s+1:s,i.selectionEnd=a+(s===a?1:2),e.call(n)},handleKeyEvt_left_bracket:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,a=i.selectionEnd,l=i.value;t.shiftKey?'"':"'";return t.shiftKey?(t.preventDefault(),i.value=l.substring(0,s)+"("+l.substring(s,a)+")"+l.substring(a),i.selectionStart=s===a?s+1:s,i.selectionEnd=a+(s===a?1:2),void e.call(n)):e.call(n)},handleKeyEvt_i:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,a=i.selectionEnd,l=i.value;return t.ctrlKey?(t.preventDefault(),i.value=l.substring(0,s)+"<i>"+l.substring(s,a)+"</i>"+l.substring(a),i.selectionStart=s===a?s+3:s,i.selectionEnd=a+(s===a?3:7),void e.call(n)):e.call(n)},handleKeyEvt_b:function(t,e){var n=this,i=this.getTextArea(),s=i.selectionStart,a=i.selectionEnd,l=i.value;return t.ctrlKey?(t.preventDefault(),i.value=l.substring(0,s)+"<b>"+l.substring(s,a)+"</b>"+l.substring(a),i.selectionStart=s===a?s+3:s,i.selectionEnd=a+(s===a?3:7),void e.call(n)):e.call(n)}}})},"object"==typeof exports?module.exports=i:"function"==typeof define&&define.amd?define([],function(){return i}):t.Vue&&(t.jadeEditor=i)}(window,document);